<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Misi Untuk Ika - Final Update</title>

    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Nunito:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #0b0d17;
            background-image: radial-gradient(white, rgba(255, 255, 255, .2) 2px, transparent 3px), radial-gradient(white, rgba(255, 255, 255, .15) 1px, transparent 2px), radial-gradient(white, rgba(255, 255, 255, .1) 2px, transparent 3px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 40px 60px, 130px 270px;
            font-family: 'VT323', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
        }

        #game-box {
            position: relative;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            max-height: 800px;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #astronaut {
            position: absolute;
            width: 50px;
            height: 50px;
            font-size: 40px;
            left: 50px;
            top: 50%;
            transition: transform 0.1s;
            z-index: 10;
        }

        .spin-anim {
            animation: spinEffect 0.6s ease-in-out;
        }

        @keyframes spinEffect {
            0% {
                transform: rotate(0deg) scale(1);
            }

            50% {
                transform: rotate(180deg) scale(1.3);
            }

            100% {
                transform: rotate(360deg) scale(1);
            }
        }

        .obstacle,
        .star,
        .fun-item {
            position: absolute;
            font-size: 30px;
            left: 100%;
        }

        #main-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 13, 23, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            color: #4facfe;
            text-shadow: 0 0 10px #00f260;
            margin-bottom: 10px;
        }

        p.subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            color: #ccc;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .btn {
            background: transparent;
            border: 2px solid #4facfe;
            color: #4facfe;
            padding: 15px 30px;
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 200px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:hover,
        .btn:active {
            background: #4facfe;
            color: #0b0d17;
            box-shadow: 0 0 15px #4facfe;
        }

        .menu-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 10px;
        }

        /* --- NEW STATS CONTAINER (Top Left) --- */
        .top-left-stats {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 110;
            display: flex;
            align-items: center;
            gap: 10px;
            /* Jarak antara koin dan badge */
        }

        /* Update: corner-display now relative inside container */
        .corner-display {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #hud {
            position: absolute;
            top: 70px;
            left: 20px;
            font-size: 1.5rem;
            z-index: 50;
            display: none;
        }

        #pause-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #fff;
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 110;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #mining-modal,
        #shop-modal,
        #memory-modal,
        #battle-modal,
        #pause-menu,
        #game-2048-modal,
        #drop-modal,
        #vip-modal,
        #promo-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            z-index: 120;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #pause-menu {
            background: rgba(11, 13, 23, 0.9);
            backdrop-filter: blur(5px);
        }

        .msg-float {
            position: absolute;
            color: rgba(255, 255, 255, 0.9);
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: bold;
            white-space: nowrap;
            animation: fadeUp 2.5s forwards;
            pointer-events: none;
            z-index: 90;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }

        @keyframes fadeUp {
            0% {
                opacity: 0;
                transform: translateY(0);
            }

            15% {
                opacity: 1;
                transform: translateY(-10px);
            }

            100% {
                opacity: 0;
                transform: translateY(-60px);
            }
        }

        .final-letter {
            font-family: 'Nunito', sans-serif;
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #333;
        }

        #moon-rock {
            font-size: 100px;
            cursor: pointer;
            transition: transform 0.1s;
            margin: 20px;
            filter: drop-shadow(0 0 15px rgba(100, 100, 255, 0.5));
        }

        .rock-hit {
            transform: scale(0.9);
        }

        .close-btn {
            margin-top: 20px;
            background: #ff4b4b;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
        }

        .mining-score {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 50vh;
            overflow-y: auto;
            padding: 10px;
            width: 90%;
        }

        .shop-section-title {
            width: 100%;
            color: #fff;
            background: #2c5364;
            padding: 5px;
            text-align: center;
            grid-column: span 2;
            margin-top: 10px;
            border-radius: 5px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4facfe;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .shop-emoji {
            font-size: 40px;
            margin-bottom: 5px;
        }

        .shop-btn {
            margin-top: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            width: 100%;
        }

        .btn-buy {
            background: #4facfe;
            color: #000;
        }

        .btn-equip {
            background: #00f260;
            color: #000;
        }

        .btn-equipped {
            background: #ccc;
            color: #555;
            cursor: default;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .memory-card {
            width: 60px;
            height: 60px;
            background: #4facfe;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            color: transparent;
            transition: all 0.3s;
            border: 2px solid #fff;
        }

        .memory-card.flipped,
        .memory-card.matched {
            background: #fff;
            color: #000;
        }

        .memory-card.matched {
            background: #00f260;
            border-color: #00f260;
        }

        .battle-arena {
            width: 90%;
            height: 300px;
            background: url('https://img.freepik.com/free-vector/space-background-with-landscape-planet_107791-628.jpg');
            background-size: cover;
            border: 2px solid #4facfe;
            border-radius: 10px;
            position: relative;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 20px;
        }

        .fighter {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .fighter-emoji {
            font-size: 60px;
            transition: transform 0.2s;
        }

        .hit-anim {
            animation: shake 0.5s;
            filter: brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5);
        }

        @keyframes shake {
            0% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }

            100% {
                transform: translateX(0);
            }
        }

        .hp-bar {
            width: 80px;
            height: 10px;
            background: #333;
            border: 1px solid #fff;
            margin-top: 5px;
            position: relative;
        }

        .hp-fill {
            height: 100%;
            background: #00f260;
            width: 100%;
            transition: width 0.3s;
        }

        .battle-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 90%;
        }

        .battle-btn {
            background: #4facfe;
            border: none;
            padding: 15px;
            color: #000;
            font-family: 'VT323';
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 5px;
        }

        .battle-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .dmg-text {
            position: absolute;
            color: #ff4b4b;
            font-weight: bold;
            font-size: 1.5rem;
            animation: floatUp 1s forwards;
            top: 0;
        }

        @keyframes floatUp {
            to {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        /* PROMO & VIP STYLES (NEW) */
        #promo-trigger {
            position: absolute;
            top: 80px;
            left: 20px;
            /* Turunin posisi promo supaya gak numpuk */
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border-radius: 50%;
            border: 2px solid #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 25px;
            cursor: pointer;
            z-index: 110;
            box-shadow: 0 0 15px #ffd700;
            animation: pulsePromo 1.5s infinite;
        }

        @keyframes pulsePromo {
            0% {
                transform: scale(1);
                box-shadow: 0 0 10px #ffd700;
            }

            50% {
                transform: scale(1.1);
                box-shadow: 0 0 20px #ffd700;
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 10px #ffd700;
            }
        }

        #vip-badge {
            /* Relative karena sekarang di dalam flex container */
            background: linear-gradient(90deg, #ffd700, #ffecb3);
            color: #5a3a00;
            padding: 5px 10px;
            border-radius: 15px;
            font-family: 'VT323';
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid #fff;
            display: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            cursor: pointer;
            transition: transform 0.2s;
        }

        #vip-badge:active {
            transform: scale(0.95);
        }

        #promo-modal,
        #vip-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .promo-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            position: relative;
            animation: scaleUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .promo-title {
            color: #ffd700;
            font-family: 'VT323';
            font-size: 2.8rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0px #000;
            letter-spacing: 2px;
        }

        .promo-icon {
            font-size: 5rem;
            margin: 10px 0;
            filter: drop-shadow(0 0 15px rgba(0, 242, 96, 0.6));
            animation: floatDiamond 3s ease-in-out infinite;
        }

        .promo-desc {
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            color: #e0e0e0;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .price-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: 'VT323';
            font-size: 1.8rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .promo-price {
            text-decoration: line-through;
            color: #ff4b4b;
            opacity: 0.8;
            font-size: 1.5rem;
        }

        .promo-free {
            color: #00f260;
            font-weight: bold;
            font-size: 2rem;
            text-shadow: 0 0 10px #00f260;
            animation: pulseText 1.5s infinite;
        }

        .btn-claim {
            background: linear-gradient(90deg, #00f260, #05c46b);
            color: #000;
            border: none;
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 242, 96, 0.4);
            border-radius: 10px;
            font-family: 'VT323';
            cursor: pointer;
        }

        .btn-claim:active {
            transform: scale(0.95);
        }

        .btn-later {
            background: transparent;
            border: none;
            color: #aaa;
            margin-top: 15px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: underline;
            font-family: 'Nunito';
        }

        /* VIP Benefits List Styles */
        .vip-list {
            text-align: left;
            margin-bottom: 20px;
            font-family: 'Nunito';
            font-size: 1rem;
            color: #fff;
            padding-left: 20px;
        }

        .vip-list li {
            margin-bottom: 8px;
            list-style: none;
            position: relative;
        }

        .vip-list li::before {
            content: "‚ú® ";
            position: absolute;
            left: -25px;
        }

        @keyframes floatDiamond {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px) scale(1.1);
            }
        }

        @keyframes pulseText {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        @keyframes scaleUp {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* --- 2048 STYLES --- */
        #game-2048-modal {
            background: rgba(15, 17, 26, 0.98);
        }

        #board-2048 {
            width: 320px;
            height: 320px;
            background: #151922;
            border: 4px solid #2c5364;
            border-radius: 10px;
            position: relative;
            margin-bottom: 20px;
            touch-action: none;
        }

        .grid-cell-bg {
            position: absolute;
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            z-index: 1;
        }

        .tile-new {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #fff;
            z-index: 2;
            transition: left 0.15s ease-in-out, top 0.15s ease-in-out, transform 0.1s;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            font-family: 'Nunito', sans-serif;
        }

        .tile-inner {
            font-size: 35px;
            line-height: 1;
        }

        .tile-val {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 2px;
        }

        .pop-anim {
            animation: pop 0.2s ease-in;
        }

        @keyframes pop {
            0% {
                transform: scale(0.5);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        /* THEMA PLANET */
        .t-2 {
            background: linear-gradient(135deg, #7f8c8d, #bdc3c7);
        }

        .t-4 {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .t-8 {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .t-16 {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }

        .t-32 {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .t-64 {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .t-128 {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .t-256 {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }

        .t-512 {
            background: linear-gradient(135deg, #ecf0f1, #95a5a6);
            color: #000 !important;
        }

        .t-1024 {
            background: linear-gradient(135deg, #000000, #434343);
            border: 1px solid gold;
        }

        .t-2048 {
            background: linear-gradient(135deg, #f39c12, #fff);
            border: 2px solid gold;
            box-shadow: 0 0 20px gold;
        }

        .score-box-2048 {
            background: #2c5364;
            padding: 5px 15px;
            border-radius: 5px;
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 10px;
            border: 1px solid #4facfe;
        }

        .controls-hint {
            color: #aaa;
            font-size: 0.8rem;
            margin-top: 5px;
            text-align: center;
        }

        /* --- COSMIC DROP (SUIKA) STYLES --- */
        #drop-canvas {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #fff;
            border-bottom: 4px solid #e91e63;
            border-radius: 5px;
            cursor: crosshair;
            box-shadow: 0 0 15px rgba(233, 30, 99, 0.3);
        }
    </style>
</head>

<body>

    <div id="game-box">
        <div id="main-menu">
            <h1>ü§çFRANSISKA JOURNEYü§ç</h1>
            <p class="subtitle">Ayo Ikaa kumpulkan sinyal memori.</p>
            <button class="btn" onclick="startGame()">üöÄ Mulai Misi</button>
            <div class="menu-row">
                <button class="btn" style="width: auto;" onclick="openMining()">‚õèÔ∏è Tambang</button>
                <button class="btn" style="width: auto;" onclick="openBattle()">‚öîÔ∏è Battle</button>
                <button class="btn" style="width: auto;" onclick="openMemory()">üîÆ Memori</button>
                <button class="btn" style="width: auto;" onclick="openShop()">üõí Toko</button>
            </div>
            <div class="menu-row">
                <button class="btn" style="width: auto; border-color: #ffd700; color: #ffd700;" onclick="open2048()">ü™ê
                    Plan-2048</button>
                <button class="btn" style="width: auto; border-color: #e91e63; color: #e91e63;" onclick="openDrop()">üíñ
                    Love Drop</button>
            </div>
            <button class="btn" style="width: auto; font-size: 1rem; margin-top: 5px;"
                onclick="showAbout()">Tentang</button>

            <div class="top-left-stats">
                <div class="corner-display">ü™ô <span id="coin-display">0</span></div>
                <div id="vip-badge" onclick="showVipBenefits()">üëë VIP MEMBER</div>
            </div>

            <div id="promo-trigger" onclick="openPromo()">üéÅ</div>
        </div>

        <button id="pause-btn" onclick="togglePause()">‚è∏Ô∏è</button>

        <div id="pause-menu">
            <h2 style="color: #4facfe; margin-bottom: 20px; font-size: 2.5rem;">PAUSED</h2>
            <button class="btn" onclick="togglePause()">Lanjut Main</button>
            <button class="btn" onclick="restartGame()">Ulangi</button>
            <button class="btn" style="border-color: #ff4b4b; color: #ff4b4b;" onclick="exitToMenu()">Menu
                Utama</button>
        </div>

        <div id="mining-modal">
            <h2 style="color: #4facfe; font-family: 'VT323'; margin-bottom: 10px;">MOON MINING</h2>
            <div class="mining-score">Koin: <span id="mine-score">0</span></div>
            <div id="moon-rock" onclick="mineRock()">üåë</div>
            <p style="color: #aaa; font-size: 0.9rem;">Ketuk batu untuk cari koin!</p>
            <button class="close-btn" onclick="closeMining()">Kembali</button>
        </div>

        <div id="memory-modal">
            <h2 style="color: #4facfe; font-family: 'VT323'; margin-bottom: 10px;">SPACE MEMORY</h2>
            <div class="memory-grid" id="memory-board"></div>
            <button class="close-btn" onclick="closeMemory()">Kembali</button>
        </div>

        <div id="game-2048-modal">
            <h2 style="color: #4facfe; font-family: 'VT323'; margin-bottom: 5px;">PLANET 2048</h2>
            <div class="score-box-2048">Skor: <span id="score-2048">0</span></div>
            <div id="board-2048"></div>
            <div class="controls-hint">PC: WASD / Panah<br>HP: Geser Layar</div>
            <button class="close-btn" onclick="close2048()">Kembali</button>
        </div>

        <div id="drop-modal">
            <h2 style="color: #e91e63; font-family: 'VT323'; margin-bottom: 5px;">LOVE & SPACE DROP</h2>
            <div class="score-box-2048" style="border-color:#e91e63; background: #3a1b29;">Skor: <span
                    id="score-drop">0</span></div>
            <canvas id="drop-canvas" width="320" height="400"></canvas>
            <div class="controls-hint">Tap/Klik di mana saja untuk menjatuhkan!<br>Awas batas atas!</div>
            <button class="close-btn" onclick="closeDrop()">Kembali</button>
        </div>

        <div id="battle-modal">
            <h2 style="color: #ff4b4b; font-family: 'VT323'; margin-bottom: 5px;">ALIEN BATTLE</h2>
            <p style="color:#ccc; font-size:0.9rem; margin-bottom:10px;">Lawan Alien untuk dapat Koin!</p>
            <div class="battle-arena">
                <div class="fighter" id="hero-fighter">
                    <div class="hp-bar">
                        <div class="hp-fill" id="hero-hp"></div>
                    </div>
                    <div class="fighter-emoji" id="hero-sprite">üßë‚ÄçüöÄ</div><span style="font-size:0.8rem">YOU</span>
                </div>
                <div class="fighter" id="enemy-fighter">
                    <div class="hp-bar">
                        <div class="hp-fill" id="enemy-hp"></div>
                    </div>
                    <div class="fighter-emoji" id="enemy-sprite">üëæ</div><span style="font-size:0.8rem">ALIEN</span>
                </div>
            </div>
            <div class="battle-controls">
                <button class="battle-btn" id="atk-btn" onclick="playerAttack()">üî´ Serang</button>
                <button class="battle-btn" style="background:#00f260" onclick="playerHeal()">üíä Heal</button>
            </div>
            <div id="battle-log" style="height:20px; color:#ffd700; margin-top:5px; font-size:0.9rem;"></div>
            <button class="close-btn" onclick="closeBattle()">Kabur</button>
        </div>

        <div id="shop-modal">
            <h2 style="color: #4facfe; font-family: 'VT323';">TOKO SPACE</h2>
            <p style="color: #ffd700;">Saldo: ü™ô <span id="shop-balance">0</span></p>
            <div class="shop-grid" id="shop-container"></div>
            <button class="close-btn" onclick="closeShop()">Kembali</button>
        </div>

        <div id="promo-modal">
            <div class="promo-content">
                <h2 class="promo-title">SPECIAL OFFER!</h2>

                <div class="promo-icon">üíé</div>

                <p style="font-family: 'Nunito'; margin-bottom: 10px; font-size: 1.1rem;">
                    Dapatkan <b>10.000 Koin</b> Langsung!
                </p>

                <p class="promo-desc">
                    <i>"Kesempatan langka untuk Darius! Jangan lewatkan bonus ini."</i>
                </p>

                <div class="price-box">
                    <span class="promo-price">Rp 99.000</span>
                    <span class="promo-free">GRATIS</span>
                </div>

                <button class="btn-claim" onclick="claimPromo()">AMBIL SEKARANG üöÄ</button>
                <button class="btn-later" onclick="closePromo()">Nanti Saja</button>
            </div>
        </div>

        <div id="vip-modal">
            <div class="promo-content" style="border-color: #ffd700;">
                <h2 class="promo-title">VIP BENEFITS</h2>
                <div class="promo-icon">üëë</div>

                <ul class="vip-list">
                    <li><b>Skin Eksklusif:</b> Golden Astro üü° (Gratis!)</li>
                    <li><b>Bonus Koin:</b> +10.000 Koin Awal</li>
                    <li><b>Status:</b> Badge VIP Keren</li>
                    <li><b>Status:</b> lope lope dari Darius ‚ù§Ô∏è</li>
                    <li><b>Support:</b>ü§ç Terima Kasih Ikaa ü§ç</li>
                </ul>

                <button class="btn-claim" onclick="closeVipBenefits()"> ¬† Yipiii</button>
            </div>
        </div>

        <div id="hud">Sinyal: <span id="score">0</span>%</div>
        <div id="astronaut">üßë‚ÄçüöÄ</div>
        <div id="game-objects"></div>
    </div>

    <script>
        // --- ONLINE AUDIO ASSETS (STABLE CDN) ---
        const sounds = {
            bgm: new Audio('https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3'),
            click: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_5b8277259f.mp3'),
            jump: new Audio('https://cdn.pixabay.com/download/audio/2022/03/24/audio_c8c8a73467.mp3'),
            coin: new Audio('https://cdn.pixabay.com/download/audio/2021/08/09/audio_88447e769f.mp3'),
            crash: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_c290130986.mp3'),
            mining: new Audio('https://cdn.pixabay.com/download/audio/2022/03/24/audio_3f728c7349.mp3'),
            laser: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_3320c2a71f.mp3'),
            hit: new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_243463a0a6.mp3'),
            win: new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c153e1.mp3'),
            card: new Audio('https://cdn.pixabay.com/download/audio/2022/03/24/audio_8340d2d323.mp3'),
            notif: new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_c6ccf3232f.mp3'),
            pop: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_c8c8a73467.mp3'), // reused jump for pop
            star: new Audio('https://cdn.pixabay.com/download/audio/2021/08/09/audio_03e647c0f2.mp3'), // Collect Star
            powerup: new Audio('https://cdn.pixabay.com/download/audio/2022/03/19/audio_97063d3329.mp3'), // Fun Item
            heal: new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_736862b624.mp3') // Heal
        };

        sounds.bgm.loop = true;
        sounds.bgm.volume = 0.3;

        function playSound(key) {
            if (sounds[key]) {
                sounds[key].currentTime = 0;
                sounds[key].play().catch(() => { });
            }
        }

        function playBGM() {
            sounds.bgm.play().catch(() => { });
        }

        const astronaut = document.getElementById('astronaut');
        const gameBox = document.getElementById('game-box');
        const mainMenu = document.getElementById('main-menu');
        const hud = document.getElementById('hud');
        const scoreEl = document.getElementById('score');
        const gameObjectsDiv = document.getElementById('game-objects');
        const pauseBtn = document.getElementById('pause-btn');
        const pauseMenu = document.getElementById('pause-menu');

        const miningModal = document.getElementById('mining-modal');
        const shopModal = document.getElementById('shop-modal');
        const memoryModal = document.getElementById('memory-modal');
        const battleModal = document.getElementById('battle-modal');
        const promoModal = document.getElementById('promo-modal');
        const vipModal = document.getElementById('vip-modal');
        const modal2048 = document.getElementById('game-2048-modal');
        const modalDrop = document.getElementById('drop-modal');

        const coinDisplay = document.getElementById('coin-display');
        const shopBalance = document.getElementById('shop-balance');
        const shopContainer = document.getElementById('shop-container');
        const promoTrigger = document.getElementById('promo-trigger');
        const vipBadge = document.getElementById('vip-badge');

        let moonCoins = parseInt(localStorage.getItem('moonCoins')) || 0;
        let unlockedSkins = JSON.parse(localStorage.getItem('unlockedSkins')) || ['skin_0'];
        let unlockedWeapons = JSON.parse(localStorage.getItem('unlockedWeapons')) || ['wep_0'];
        let currentSkin = localStorage.getItem('currentSkin') || 'skin_0';
        let currentWeapon = localStorage.getItem('currentWeapon') || 'wep_0';
        let isVip = localStorage.getItem('isVip') === 'true';

        let isGameRunning = false, isPaused = false, hasShownLetter = false;
        let score = 0, gravity = 0.25, velocity = 0, astroTop = 50;
        let gameLoop = null, spawnerLoop = null, msgIndex = 0;

        const skins = [
            { id: 'skin_0', name: 'Default', emoji: 'üßë‚ÄçüöÄ', price: 0 },
            { id: 'skin_1', name: 'Super Astro', emoji: 'ü¶∏', price: 50 },
            { id: 'skin_2', name: 'Mecha Bot', emoji: 'ü§ñ', price: 150 },
            { id: 'skin_3', name: 'Alien', emoji: 'üëΩ', price: 300 },
            { id: 'skin_4', name: 'Pixel Void', emoji: 'üëæ', price: 500 },
            { id: 'skin_vip', name: 'Golden Astro', emoji: 'üü°', price: 99999, vipOnly: true } // New VIP Skin
        ];
        const weapons = [
            { id: 'wep_0', name: 'Laser Gun', emoji: 'üî´', dmg: 15, price: 0 },
            { id: 'wep_1', name: 'Plasma Sword', emoji: '‚öîÔ∏è', dmg: 35, price: 200 },
            { id: 'wep_2', name: 'Rocket', emoji: 'üöÄ', dmg: 60, price: 500 },
            { id: 'wep_3', name: 'Zeus Thunder', emoji: '‚ö°', dmg: 100, price: 1000 }
        ];
        const messages = ["Hai Ika...", "Maaf ya...", "Aku sadar...", "Aku banyak salah...", "Kali ini...", "Aku akan lebih baik...", "Terima kasih..."];
        const funItems = [
            { emoji: 'üê±', type: 'cat', msg: 'Meow! (+10)' },
            { emoji: 'üçï', type: 'pizza', msg: 'Nyam! (+10)' },
            { emoji: 'üõ∏', type: 'ufo', msg: 'Wuzzz! (+10)' },
            { emoji: 'üíé', type: 'gem', msg: 'Bling! (+10)' }
        ];

        // INITIALIZATION
        updateCoinDisplay(); updateAstronautSkin(); updateBattleButton(); checkVipStatus();

        function checkVipStatus() {
            if (isVip) {
                promoTrigger.style.display = 'none';
                vipBadge.style.display = 'block';
                // Unlock VIP skin if not already
                if (!unlockedSkins.includes('skin_vip')) {
                    unlockedSkins.push('skin_vip');
                    localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
                }
            } else {
                promoTrigger.style.display = 'flex';
                vipBadge.style.display = 'none';
            }
        }

        function updateCoinDisplay() {
            coinDisplay.innerText = moonCoins; document.getElementById('mine-score').innerText = moonCoins;
            shopBalance.innerText = moonCoins; localStorage.setItem('moonCoins', moonCoins);
        }
        function updateAstronautSkin() {
            const skinData = skins.find(s => s.id === currentSkin);
            if (skinData) { astronaut.innerText = skinData.emoji; document.getElementById('hero-sprite').innerText = skinData.emoji; }
        }
        function updateBattleButton() {
            const wepData = weapons.find(w => w.id === currentWeapon);
            document.getElementById('atk-btn').innerHTML = `${wepData.emoji} Serang`;
        }

        // --- PROMO & VIP ---
        function openPromo() { playSound('click'); promoModal.style.display = 'flex'; }
        function closePromo() { playSound('click'); promoModal.style.display = 'none'; }

        function showVipBenefits() { playSound('click'); vipModal.style.display = 'flex'; }
        function closeVipBenefits() { playSound('click'); vipModal.style.display = 'none'; }

        function claimPromo() {
            playSound('win');
            moonCoins += 10000;
            isVip = true;
            localStorage.setItem('isVip', 'true');
            localStorage.setItem('moonCoins', moonCoins);
            updateCoinDisplay();
            checkVipStatus();
            closePromo();

            Swal.fire({
                title: 'VIP AKTIF! üëë',
                text: 'Terima kasih atas kesempatannya. 10.000 Koin & Skin Golden Astro telah ditambahkan!',
                icon: 'success',
                background: '#1a1a2e', color: '#fff', confirmButtonColor: '#ffd700'
            });
        }

        // --- NAVIGATION ---
        function togglePause() {
            playSound('click');
            if (isPaused) {
                isPaused = false; pauseMenu.style.display = 'none';
            } else {
                isPaused = true; pauseMenu.style.display = 'flex';
            }
        }
        function restartGame() {
            playSound('click');
            pauseMenu.style.display = 'none';
            clearInterval(gameLoop);
            clearInterval(spawnerLoop);
            startGame();
        }
        function exitToMenu() {
            playSound('click');
            isGameRunning = false;
            clearInterval(gameLoop); clearInterval(spawnerLoop);
            pauseMenu.style.display = 'none';
            hud.style.display = 'none';
            pauseBtn.style.display = 'none';
            gameObjectsDiv.innerHTML = '';
            mainMenu.style.display = 'flex';
        }

        // --- 2048 ENGINE ---
        const planetMap = { 2: 'üåë', 4: '‚òÑÔ∏è', 8: 'üõ∞Ô∏è', 16: 'üåé', 32: 'üåï', 64: 'ü™ê', 128: 'üëΩ', 256: 'üåå', 512: '‚≠ê', 1024: 'üï≥Ô∏è', 2048: 'üëë' };
        let boardSize = 4, cells = [], score2048 = 0, tileIdCounter = 0;

        function open2048() { playSound('click'); modal2048.style.display = 'flex'; init2048(); }
        function close2048() { playSound('click'); modal2048.style.display = 'none'; document.removeEventListener('keydown', handleInput2048); document.getElementById('board-2048').innerHTML = ''; }

        function init2048() {
            const board = document.getElementById('board-2048'); board.innerHTML = '';
            cells = Array(boardSize).fill(null).map(() => Array(boardSize).fill(null)); score2048 = 0;
            document.getElementById('score-2048').innerText = score2048;
            for (let r = 0; r < boardSize; r++) for (let c = 0; c < boardSize; c++) { let bg = document.createElement('div'); bg.classList.add('grid-cell-bg'); bg.style.top = (10 + r * 75) + 'px'; bg.style.left = (10 + c * 75) + 'px'; board.appendChild(bg); }
            spawnTile2048(); spawnTile2048();
            document.addEventListener('keydown', handleInput2048); setupTouch2048();
        }
        function spawnTile2048() {
            let options = []; for (let r = 0; r < boardSize; r++) for (let c = 0; c < boardSize; c++) if (!cells[r][c]) options.push({ r, c });
            if (options.length > 0) { let spot = options[Math.floor(Math.random() * options.length)]; let tile = { id: tileIdCounter++, val: Math.random() < 0.9 ? 2 : 4, r: spot.r, c: spot.c }; cells[spot.r][spot.c] = tile; renderTile(tile); }
        }
        function renderTile(tile) {
            const board = document.getElementById('board-2048'); let el = document.getElementById(`tile-${tile.id}`); let icon = planetMap[tile.val] || tile.val;
            if (!el) { el = document.createElement('div'); el.id = `tile-${tile.id}`; el.classList.add('tile-new', `t-${tile.val}`, 'pop-anim'); el.innerHTML = `<div class="tile-inner">${icon}</div><div class="tile-val">${tile.val}</div>`; board.appendChild(el); }
            else { el.className = `tile-new t-${tile.val}`; if (tile.mergedFrom) { el.classList.add('pop-anim'); setTimeout(() => el.classList.remove('pop-anim'), 200); } el.innerHTML = `<div class="tile-inner">${icon}</div><div class="tile-val">${tile.val}</div>`; }
            el.style.top = (10 + tile.r * 75) + 'px'; el.style.left = (10 + tile.c * 75) + 'px';
        }
        function move2048(direction) {
            let moved = false; let vectors = { 'up': { x: 0, y: -1 }, 'down': { x: 0, y: 1 }, 'left': { x: -1, y: 0 }, 'right': { x: 1, y: 0 } };
            let vector = vectors[direction]; let traversals = { x: [0, 1, 2, 3], y: [0, 1, 2, 3] };
            if (vector.x === 1) traversals.x.reverse(); if (vector.y === 1) traversals.y.reverse();
            for (let r = 0; r < 4; r++) for (let c = 0; c < 4; c++) if (cells[r][c]) cells[r][c].mergedFrom = null;
            traversals.y.forEach(r => {
                traversals.x.forEach(c => {
                    let tile = cells[r][c];
                    if (tile) {
                        let positions = findFarthestPosition(r, c, vector); let next = getCell(positions.next);
                        if (next && next.val === tile.val && !next.mergedFrom) {
                            let merged = { id: tileIdCounter++, val: tile.val * 2, r: next.r, c: next.c, mergedFrom: [tile, next] };
                            cells[r][c] = null; cells[next.r][next.c] = merged;
                            tile.r = next.r; tile.c = next.c; renderTile(tile);
                            setTimeout(() => { removeTileDOM(tile); removeTileDOM(next); renderTile(merged); }, 150);
                            score2048 += merged.val; if (merged.val >= 64) { moonCoins += 5; updateCoinDisplay(); } moved = true;
                        } else {
                            cells[r][c] = null; cells[positions.farthest.r][positions.farthest.c] = tile;
                            if (tile.r !== positions.farthest.r || tile.c !== positions.farthest.c) { tile.r = positions.farthest.r; tile.c = positions.farthest.c; renderTile(tile); moved = true; }
                        }
                    }
                });
            });
            if (moved) { document.getElementById('score-2048').innerText = score2048; setTimeout(() => spawnTile2048(), 150); playSound('click'); }
        }
        function getCell(pos) { return (pos.r >= 0 && pos.r < 4 && pos.c >= 0 && pos.c < 4) ? cells[pos.r][pos.c] : null; }
        function findFarthestPosition(r, c, vector) { let previous; do { previous = { r, c }; r += vector.y; c += vector.x; } while (r >= 0 && r < 4 && c >= 0 && c < 4 && !cells[r][c]); return { farthest: previous, next: { r, c } }; }
        function removeTileDOM(tile) { let el = document.getElementById(`tile-${tile.id}`); if (el) el.remove(); }
        function handleInput2048(e) { if (modal2048.style.display === 'none') return; if (['ArrowUp', 'w', 'W'].includes(e.key)) move2048('up'); else if (['ArrowDown', 's', 'S'].includes(e.key)) move2048('down'); else if (['ArrowLeft', 'a', 'A'].includes(e.key)) move2048('left'); else if (['ArrowRight', 'd', 'D'].includes(e.key)) move2048('right'); }
        function setupTouch2048() {
            let startX, startY; const board = document.getElementById('board-2048');
            board.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, { passive: false });
            board.addEventListener('touchend', (e) => { if (!startX || !startY) return; let diffX = e.changedTouches[0].clientX - startX; let diffY = e.changedTouches[0].clientY - startY; if (Math.abs(diffX) > Math.abs(diffY)) { if (Math.abs(diffX) > 30) move2048(diffX > 0 ? 'right' : 'left'); } else { if (Math.abs(diffY) > 30) move2048(diffY > 0 ? 'down' : 'up'); } startX = null; startY = null; }, { passive: false });
            board.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
        }

        // --- LOVE & SPACE DROP (SUIKA STYLE) ENGINE ---
        let dropCanvas, dropCtx, dropScore = 0;
        let dropBalls = [];
        let dropNextBallType = 0;
        let dropMouseX = 160;
        let dropGameLoop;
        let canDrop = true; // COOLDOWN FLAG
        const gameOverLine = 100;

        const dropTypes = [
            { r: 15, color: '#e74c3c', icon: '‚ù§Ô∏è', score: 2 },
            { r: 25, color: '#e67e22', icon: 'üß°', score: 4 },
            { r: 35, color: '#7f8c8d', icon: 'üåë', score: 8 },
            { r: 45, color: '#f1c40f', icon: 'üíõ', score: 16 },
            { r: 55, color: '#3498db', icon: 'üåé', score: 32 },
            { r: 70, color: '#2ecc71', icon: 'üíö', score: 64 },
            { r: 85, color: '#9b59b6', icon: 'ü™ê', score: 128 },
            { r: 100, color: '#3498db', icon: 'üíô', score: 256 },
            { r: 120, color: '#f39c12', icon: '‚òÄÔ∏è', score: 512 },
            { r: 140, color: '#9b59b6', icon: 'üíú', score: 1024 },
            { r: 160, color: '#e91e63', icon: 'üíñ', score: 2048 }
        ];

        function openDrop() {
            playSound('click'); modalDrop.style.display = 'flex';
            dropCanvas = document.getElementById('drop-canvas'); dropCtx = dropCanvas.getContext('2d');
            resetDropGame();

            // Event Listeners for "Tap to Drop"
            const updatePos = (e) => {
                const rect = dropCanvas.getBoundingClientRect();
                let clientX;
                if (e.touches && e.touches.length > 0) clientX = e.touches[0].clientX;
                else if (e.changedTouches && e.changedTouches.length > 0) clientX = e.changedTouches[0].clientX;
                else clientX = e.clientX;
                dropMouseX = clientX - rect.left;
            };

            // Visual Aiming
            dropCanvas.addEventListener('mousemove', (e) => { updatePos(e); });
            dropCanvas.addEventListener('touchmove', (e) => { e.preventDefault(); updatePos(e); }, { passive: false });

            // Action: Update Pos & Drop
            const handleTap = (e) => {
                e.preventDefault();
                updatePos(e);
                dropTheBall();
            };

            dropCanvas.addEventListener('mousedown', handleTap);
            dropCanvas.addEventListener('touchstart', handleTap, { passive: false });
        }

        function closeDrop() { playSound('click'); modalDrop.style.display = 'none'; clearInterval(dropGameLoop); }

        function getNextBallType() {
            let r = Math.random();
            if (r > 0.999) return 2; // 0.1% Chance Size 3
            else if (r > 0.40) return 0; // ~60% Chance Size 1
            else return 1; // ~39.9% Chance Size 2
        }

        function resetDropGame() {
            dropScore = 0; document.getElementById('score-drop').innerText = 0;
            dropBalls = []; canDrop = true;
            dropNextBallType = getNextBallType();
            if (dropGameLoop) clearInterval(dropGameLoop);
            dropGameLoop = setInterval(updateDropGame, 1000 / 60);
        }

        function dropTheBall() {
            if (!canDrop) return; // Wait for cooldown

            const type = dropTypes[dropNextBallType];
            let spawnX = Math.max(type.r, Math.min(320 - type.r, dropMouseX));
            dropBalls.push({ x: spawnX, y: 50, vx: 0, vy: 0, type: dropNextBallType, r: type.r, dead: false });
            playSound('click');

            canDrop = false; // Start Cooldown
            dropNextBallType = getNextBallType();

            setTimeout(() => { canDrop = true; }, 1000); // 1 Second Delay
        }

        function updateDropGame() {
            dropCtx.clearRect(0, 0, 320, 400);

            // Draw Game Over Line
            dropCtx.beginPath(); dropCtx.moveTo(0, gameOverLine); dropCtx.lineTo(320, gameOverLine);
            dropCtx.strokeStyle = 'red'; dropCtx.setLineDash([5, 5]); dropCtx.stroke(); dropCtx.setLineDash([]);

            // Draw Next Ball Indicator & Preview (ONLY IF CAN DROP)
            if (canDrop) {
                dropCtx.beginPath(); dropCtx.moveTo(dropMouseX, 20); dropCtx.lineTo(dropMouseX, 380); dropCtx.strokeStyle = 'rgba(255,255,255,0.1)'; dropCtx.stroke();
                const nextType = dropTypes[dropNextBallType];
                dropCtx.font = "20px Arial"; dropCtx.textAlign = "center"; dropCtx.textBaseline = "middle"; dropCtx.fillText(nextType.icon, dropMouseX, 30);
            }

            let gameOverTriggered = false;

            // Physics Loop
            for (let i = 0; i < dropBalls.length; i++) {
                let b = dropBalls[i];
                b.vy += 0.5; // GRAVITY
                b.vx *= 0.95; b.vy *= 0.95; // FRICTION

                b.x += b.vx; b.y += b.vy;

                // WALLS
                if (b.x < b.r) { b.x = b.r; b.vx *= -0.3; }
                if (b.x > 320 - b.r) { b.x = 320 - b.r; b.vx *= -0.3; }
                if (b.y > 400 - b.r) { b.y = 400 - b.r; b.vy *= -0.3; }

                // Collisions
                for (let j = i + 1; j < dropBalls.length; j++) {
                    let other = dropBalls[j];
                    let dx = other.x - b.x; let dy = other.y - b.y;
                    let dist = Math.sqrt(dx * dx + dy * dy); let minDist = b.r + other.r;
                    if (dist < minDist) {
                        if (b.type === other.type) {
                            const newTypeIdx = b.type + 1;
                            if (newTypeIdx < dropTypes.length) {
                                const newType = dropTypes[newTypeIdx];
                                dropBalls.push({ x: (b.x + other.x) / 2, y: (b.y + other.y) / 2, vx: 0, vy: 0, type: newTypeIdx, r: newType.r, dead: false });
                                dropScore += newType.score; moonCoins += Math.floor(newType.score / 10); updateCoinDisplay(); document.getElementById('score-drop').innerText = dropScore; playSound('pop');
                                b.dead = true; other.dead = true;
                            }
                        } else {
                            let angle = Math.atan2(dy, dx);
                            let targetX = b.x + Math.cos(angle) * minDist; let targetY = b.y + Math.sin(angle) * minDist;
                            let ax = (targetX - other.x) * 0.1; let ay = (targetY - other.y) * 0.1;
                            b.vx -= ax; b.vy -= ay; other.vx += ax; other.vy += ay;
                            b.vx *= 0.9; b.vy *= 0.9; other.vx *= 0.9; other.vy *= 0.9;
                        }
                    }
                }
                // Game Over Check
                if (b.y > 60 && (b.y - b.r) < gameOverLine && Math.abs(b.vy) < 0.5 && Math.abs(b.vx) < 0.5 && !b.dead) {
                    gameOverTriggered = true;
                }
            }
            dropBalls = dropBalls.filter(b => !b.dead);

            // Render Balls
            dropBalls.forEach(b => {
                const info = dropTypes[b.type];
                dropCtx.font = (b.r * 1.8) + "px Arial";
                dropCtx.fillStyle = "#fff";
                dropCtx.fillText(info.icon, b.x, b.y);
            });

            if (gameOverTriggered) endDropGame();
        }

        function endDropGame() {
            clearInterval(dropGameLoop); playSound('crash');
            Swal.fire({ title: 'Game Over!', text: 'Tumpukan penuh! Skor: ' + dropScore, icon: 'error', background: '#1a1a2e', color: '#fff', confirmButtonText: 'Coba Lagi', confirmButtonColor: '#e91e63' }).then(() => { resetDropGame(); });
        }

        // --- MINI GAMES ---
        function openMining() { playSound('click'); miningModal.style.display = 'flex'; }
        function closeMining() { playSound('click'); miningModal.style.display = 'none'; }
        function mineRock() {
            playSound('mining');
            playSound('coin');
            const gain = Math.floor(Math.random() * 2) + 1;
            moonCoins += gain; updateCoinDisplay();
            const rock = document.getElementById('moon-rock'); rock.classList.add('rock-hit');
            setTimeout(() => { rock.classList.remove('rock-hit'); }, 100);
            showMiniFloat(`+${gain}ü™ô`, '50%', '40%', miningModal);
        }

        let memoryCards = [], hasFlippedCard = false, lockBoard = false, firstCard, secondCard, matchedPairs = 0;
        const memoryIcons = ['üåç', 'üöÄ', 'üëΩ', '‚≠ê', '‚òÑÔ∏è', '‚ù§Ô∏è'];
        function openMemory() {
            playSound('click'); memoryModal.style.display = 'flex';
            const board = document.getElementById('memory-board'); board.innerHTML = '';
            matchedPairs = 0; hasFlippedCard = false; lockBoard = false;
            let cards = [...memoryIcons, ...memoryIcons].sort(() => 0.5 - Math.random());
            cards.forEach(icon => {
                const card = document.createElement('div'); card.classList.add('memory-card');
                card.dataset.icon = icon; card.innerText = icon;
                card.addEventListener('click', flipCard); board.appendChild(card);
            });
        }
        function closeMemory() { playSound('click'); memoryModal.style.display = 'none'; }
        function flipCard() {
            if (lockBoard || this === firstCard) return;
            playSound('card'); this.classList.add('flipped');
            if (!hasFlippedCard) { hasFlippedCard = true; firstCard = this; return; }
            secondCard = this; checkForMatch();
        }
        function checkForMatch() { let isMatch = firstCard.dataset.icon === secondCard.dataset.icon; isMatch ? disableCards() : unflipCards(); }
        function disableCards() {
            playSound('coin'); firstCard.removeEventListener('click', flipCard); secondCard.removeEventListener('click', flipCard);
            firstCard.classList.add('matched'); secondCard.classList.add('matched'); matchedPairs++;
            if (matchedPairs === memoryIcons.length) {
                setTimeout(() => {
                    playSound('win'); moonCoins += 50; updateCoinDisplay();
                    Swal.fire({ title: 'Menang!', text: '+50 Koin!', icon: 'success', background: '#1a1a2e', color: '#fff' });
                }, 500);
            }
            resetBoard();
        }
        function unflipCards() { lockBoard = true; setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); resetBoard(); }, 1000); }
        function resetBoard() { [hasFlippedCard, lockBoard] = [false, false];[firstCard, secondCard] = [null, null]; }

        let heroHp = 100, enemyHp = 100; const maxHp = 100;
        function openBattle() { playSound('click'); battleModal.style.display = 'flex'; resetBattle(); }
        function closeBattle() { playSound('click'); battleModal.style.display = 'none'; }
        function resetBattle() {
            heroHp = maxHp; enemyHp = maxHp; updateHpUI();
            document.getElementById('battle-log').innerText = "Alien liar muncul!";
            document.getElementById('enemy-sprite').classList.remove('hit-anim'); document.getElementById('hero-sprite').classList.remove('hit-anim');
            document.getElementById('atk-btn').disabled = false;
        }
        function updateHpUI() { document.getElementById('hero-hp').style.width = heroHp + '%'; document.getElementById('enemy-hp').style.width = enemyHp + '%'; }
        function playerAttack() {
            playSound('laser'); const wep = weapons.find(w => w.id === currentWeapon);
            const dmg = Math.floor(wep.dmg * (0.8 + Math.random() * 0.4));
            enemyHp -= dmg; if (enemyHp < 0) enemyHp = 0; updateHpUI();
            showDmg(dmg, 'enemy-fighter');
            document.getElementById('enemy-sprite').classList.add('hit-anim'); setTimeout(() => document.getElementById('enemy-sprite').classList.remove('hit-anim'), 500);
            document.getElementById('battle-log').innerText = `Kamu menyerang: ${dmg} dmg!`;
            if (enemyHp === 0) { winBattle(); } else { document.getElementById('atk-btn').disabled = true; setTimeout(alienTurn, 1000); }
        }
        function playerHeal() {
            playSound('heal'); const heal = 30; heroHp += heal; if (heroHp > maxHp) heroHp = maxHp; updateHpUI();
            document.getElementById('battle-log').innerText = `Kamu healing +${heal} HP`;
            document.getElementById('atk-btn').disabled = true; setTimeout(alienTurn, 1000);
        }
        function alienTurn() {
            playSound('hit'); const dmg = Math.floor(10 + Math.random() * 15);
            heroHp -= dmg; if (heroHp < 0) heroHp = 0; updateHpUI();
            showDmg(dmg, 'hero-fighter');
            document.getElementById('hero-sprite').classList.add('hit-anim'); setTimeout(() => document.getElementById('hero-sprite').classList.remove('hit-anim'), 500);
            document.getElementById('battle-log').innerText = `Alien menyerang: ${dmg} dmg!`;
            if (heroHp === 0) { playSound('crash'); Swal.fire({ title: 'Kalah!', text: 'Kamu pingsan...', icon: 'error', background: '#1a1a2e', color: '#fff' }); resetBattle(); }
            document.getElementById('atk-btn').disabled = false;
        }
        function winBattle() {
            playSound('win'); const reward = 50 + Math.floor(Math.random() * 50); moonCoins += reward; updateCoinDisplay();
            Swal.fire({ title: 'Menang!', text: `Alien kabur! Kamu dapat ${reward} Koin!`, icon: 'success', background: '#1a1a2e', color: '#fff' }); resetBattle();
        }
        function showDmg(val, targetId) {
            const el = document.getElementById(targetId); const float = document.createElement('div');
            float.classList.add('dmg-text'); float.innerText = `-${val}`; el.appendChild(float); setTimeout(() => float.remove(), 1000);
        }

        function openShop() { playSound('click'); renderShop(); shopModal.style.display = 'flex'; }
        function closeShop() { playSound('click'); shopModal.style.display = 'none'; }
        function renderShop() {
            shopContainer.innerHTML = '';
            const skinTitle = document.createElement('div'); skinTitle.className = 'shop-section-title'; skinTitle.innerText = "SKIN KARAKTER"; shopContainer.appendChild(skinTitle);
            skins.forEach(item => createShopItem(item, 'skin'));
            const wepTitle = document.createElement('div'); wepTitle.className = 'shop-section-title'; wepTitle.innerText = "SENJATA BATTLE"; shopContainer.appendChild(wepTitle);
            weapons.forEach(item => createShopItem(item, 'weapon'));
        }
        function createShopItem(item, type) {
            const div = document.createElement('div'); div.className = 'shop-item';
            let isUnlocked, isEquipped;
            if (type === 'skin') { isUnlocked = unlockedSkins.includes(item.id); isEquipped = currentSkin === item.id; }
            else { isUnlocked = unlockedWeapons.includes(item.id); isEquipped = currentWeapon === item.id; }
            let btnHtml;
            if (item.vipOnly && !isVip) btnHtml = `<button class="shop-btn" style="background:#ff4b4b; cursor:not-allowed;" disabled>VIP ONLY</button>`;
            else if (isEquipped) btnHtml = `<button class="shop-btn btn-equipped">Terpakai</button>`;
            else if (isUnlocked) btnHtml = `<button class="shop-btn btn-equip" onclick="equipItem('${item.id}', '${type}')">Pakai</button>`;
            else btnHtml = `<button class="shop-btn btn-buy" onclick="buyItem('${item.id}', ${item.price}, '${type}')">Beli (${item.price})</button>`;
            div.innerHTML = `<div class="shop-emoji">${item.emoji}</div><div style="font-size:0.9rem; margin-bottom:5px;">${item.name}</div>${type === 'weapon' ? `<div style="font-size:0.7rem; color:#ff4b4b">DMG: ${item.dmg}</div>` : ''}${btnHtml}`;
            shopContainer.appendChild(div);
        }
        function buyItem(id, price, type) {
            if (moonCoins >= price) {
                playSound('coin'); moonCoins -= price;
                if (type === 'skin') { unlockedSkins.push(id); localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins)); }
                else { unlockedWeapons.push(id); localStorage.setItem('unlockedWeapons', JSON.stringify(unlockedWeapons)); }
                updateCoinDisplay(); renderShop();
                Swal.fire({ icon: 'success', title: 'Berhasil!', text: 'Item dibeli!', timer: 800, showConfirmButton: false, background: '#1a1a2e', color: '#fff' });
            } else { playSound('crash'); Swal.fire({ icon: 'error', title: 'Ups!', text: 'Koin kurang!', background: '#1a1a2e', color: '#fff' }); }
        }
        function equipItem(id, type) {
            playSound('click');
            if (type === 'skin') { currentSkin = id; localStorage.setItem('currentSkin', currentSkin); updateAstronautSkin(); }
            else { currentWeapon = id; localStorage.setItem('currentWeapon', currentWeapon); updateBattleButton(); }
            renderShop();
        }
        function showAbout() { playSound('click'); Swal.fire({ title: 'Info', text: 'Game Khusus untuk Fransiska Tjoe', background: '#0b0d17', color: '#fff', confirmButtonColor: '#4facfe' }); }

        // --- MAIN GAME LOOP ---
        function startGame() {
            if (gameLoop) clearInterval(gameLoop);
            if (spawnerLoop) clearInterval(spawnerLoop);

            playBGM(); mainMenu.style.display = 'none'; hud.style.display = 'block'; pauseBtn.style.display = 'flex';
            isGameRunning = true; isPaused = false; hasShownLetter = false; score = 0; scoreEl.innerText = "0"; astroTop = 50; velocity = 0; msgIndex = 0;
            gameObjectsDiv.innerHTML = '';

            gameLoop = setInterval(updateGame, 20);
            spawnerLoop = setInterval(spawnObject, 1500);
        }
        function updateGame() {
            if (!isGameRunning || isPaused) return;
            velocity += gravity; astroTop += (velocity / 5);
            if (astroTop > 95) gameOver(); if (astroTop < 0) astroTop = 0;
            astronaut.style.top = astroTop + '%';
            if (!astronaut.classList.contains('spin-anim')) astronaut.style.transform = `rotate(${velocity * 2}deg)`;
            document.querySelectorAll('.obj-item').forEach(obj => {
                let leftPos = parseFloat(obj.getAttribute('data-left')); leftPos -= 0.8;
                obj.setAttribute('data-left', leftPos); obj.style.left = leftPos + '%';
                if (leftPos < -10) obj.remove(); checkCollision(obj);
            });
        }
        function jump() { if (isGameRunning && !isPaused) { playSound('jump'); velocity = -6; } }
        document.body.addEventListener('mousedown', jump);
        document.body.addEventListener('touchstart', (e) => {
            if (e.target.closest('.btn') || e.target.closest('.shop-btn') || e.target.closest('.battle-btn') || e.target.closest('.close-btn') || e.target.closest('#mining-modal') || e.target.closest('#shop-modal') || e.target.closest('#memory-modal') || e.target.closest('#battle-modal') || e.target.closest('#pause-btn') || e.target.closest('#pause-menu') || e.target.closest('#promo-modal') || e.target.closest('#promo-trigger') || e.target.closest('#game-2048-modal') || e.target.closest('#drop-modal') || e.target.closest('#vip-modal')) return;
            e.preventDefault(); jump();
        });
        document.body.addEventListener('keydown', (e) => { if (e.code === 'Space' || e.code === 'ArrowUp') jump(); });

        function spawnObject() {
            if (!isGameRunning || isPaused) return;
            let rand = Math.random(); const el = document.createElement('div'); el.classList.add('obj-item'); el.setAttribute('data-left', 100);
            const randomTop = Math.floor(Math.random() * 80) + 10; el.style.top = randomTop + '%'; el.style.position = 'absolute'; el.style.left = '100%';
            if (rand < 0.15) {
                const item = funItems[Math.floor(Math.random() * funItems.length)];
                el.innerText = item.emoji; el.classList.add('fun-item'); el.setAttribute('data-type', 'fun'); el.setAttribute('data-msg', item.msg);
            } else if (rand < 0.55) {
                el.innerText = 'üåü'; el.classList.add('star'); el.setAttribute('data-type', 'star');
            } else {
                el.innerText = '‚òÑÔ∏è'; el.classList.add('obstacle'); el.setAttribute('data-type', 'obstacle');
            }
            gameObjectsDiv.appendChild(el);
        }
        function checkCollision(obj) {
            const r1 = astronaut.getBoundingClientRect(); const r2 = obj.getBoundingClientRect();
            if (r1.left + 10 < r2.right - 10 && r1.right - 10 > r2.left + 10 && r1.top + 10 < r2.bottom - 10 && r1.bottom - 10 > r2.top + 10) {
                const type = obj.getAttribute('data-type'); if (type === 'obstacle') gameOver(); else if (type === 'fun') collectFunItem(obj); else collectStar(obj);
            }
        }
        function collectFunItem(el) {
            playSound('powerup'); const msg = el.getAttribute('data-msg'); el.remove(); score += 5; moonCoins += 10; scoreEl.innerText = score; updateCoinDisplay();
            showFloatingText(msg + " (+10ü™ô)", '#ffeb3b'); astronaut.classList.add('spin-anim'); setTimeout(() => astronaut.classList.remove('spin-anim'), 600);
            if (score >= 100 && !hasShownLetter) showLetter();
        }
        function collectStar(starEl) {
            playSound('star'); starEl.remove(); score += 20; moonCoins += 2; scoreEl.innerText = score; updateCoinDisplay();
            let txt = "ü§ç"; if (msgIndex < messages.length) { txt = messages[msgIndex]; msgIndex++; }
            showFloatingText(txt + " (+2ü™ô)", '#fff'); if (score >= 100 && !hasShownLetter) showLetter();
        }
        function showFloatingText(text, color) {
            const txt = document.createElement('div'); txt.innerText = text; txt.classList.add('msg-float');
            txt.style.top = astronaut.style.top; txt.style.left = astronaut.style.left; txt.style.color = color;
            gameBox.appendChild(txt); setTimeout(() => txt.remove(), 2500);
        }
        function showMiniFloat(text, left, top, parent) {
            const floatTxt = document.createElement('div'); floatTxt.innerText = text; floatTxt.style.position = 'absolute';
            floatTxt.style.left = left; floatTxt.style.top = top; floatTxt.style.transform = 'translate(-50%, -50%)'; floatTxt.style.color = '#ffd700';
            floatTxt.style.fontWeight = 'bold'; floatTxt.style.fontSize = '1.5rem'; floatTxt.style.pointerEvents = 'none';
            floatTxt.style.animation = 'fadeUp 1s forwards'; parent.appendChild(floatTxt); setTimeout(() => floatTxt.remove(), 1000);
        }
        function showLetter() {
            playSound('notif'); isPaused = true; hasShownLetter = true;
            const finalMessage = `<div class="final-letter"><b>Untuk Ika,</b><br><br>Aku cuma mau bilang satu hal: Maaf. <br>Maaf buat semua sikapku yang dulu bikin kamu kecewa. Aku sadar, dulu aku banyak kurangnya, kurang peka, dan nggak menghargai apa yang ada.<br><br>Penyesalan ini mungkin telat, tapi ini jujur dari hati. Aku nggak minta apa-apa selain kamu tau kalau aku beneran nyesel pernah bikin kamu sedih.<br><br>Aku selalu mengharapkan kebahagiaan kamu. I love you, always do‚ú®</div>`;
            Swal.fire({ title: 'Pesan Masuk üì©', html: finalMessage, background: '#fff', color: '#333', width: 600, confirmButtonText: 'Lanjut Main üöÄ', confirmButtonColor: '#4facfe', allowOutsideClick: false, backdrop: `rgba(0,0,30,0.8)` }).then(() => { isPaused = false; });
        }
        function gameOver() {
            playSound('crash'); isGameRunning = false; clearInterval(gameLoop); clearInterval(spawnerLoop);
            Swal.fire({
                title: 'Misi Gagal üí•', text: 'Skor: ' + score, background: '#0b0d17', color: '#fff',
                showCancelButton: true, confirmButtonText: 'Coba Lagi', cancelButtonText: 'Menu Utama',
                confirmButtonColor: '#ff4b4b', cancelButtonColor: '#4facfe', allowOutsideClick: false
            }).then((result) => { if (result.isConfirmed) startGame(); else exitToMenu(); });
        }
    </script>
</body>

</html>